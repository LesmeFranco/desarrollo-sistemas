{% extends "base.html" %}
{% block title %} Dashboard - {{ company_name }} {% endblock %}

{% block content %}
<style>
    .dashboard-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        border-bottom: 2px solid #e0e0e0;
        padding-bottom: 20px;
    }

    .dashboard-header h1 {
        margin: 0;
        font-size: 28px;
        color: #333;
    }

    .logout-btn {
        background-color: #ff6b6b;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        transition: background-color 0.3s;
    }

    .logout-btn:hover {
        background-color: #ff5252;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .stat-card h3 {
        margin: 0 0 10px 0;
        font-size: 14px;
        opacity: 0.9;
        text-transform: uppercase;
    }

    .stat-card .value {
        font-size: 28px;
        font-weight: bold;
    }

    .stat-card.accent1 {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .stat-card.accent2 {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .stat-card.accent3 {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    .stat-card.accent4 {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }

    .data-section {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }

    .data-section h2 {
        margin-top: 0;
        margin-bottom: 15px;
        color: #333;
        border-bottom: 2px solid #667eea;
        padding-bottom: 10px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    table th {
        background-color: #f5f5f5;
        padding: 12px;
        text-align: left;
        font-weight: bold;
        color: #333;
        border-bottom: 2px solid #e0e0e0;
    }

    table td {
        padding: 12px;
        border-bottom: 1px solid #f0f0f0;
    }

    table tr:hover {
        background-color: #fafafa;
    }

    .nav-links {
        margin-bottom: 20px;
    }

    .nav-links a {
        display: inline-block;
        background-color: #667eea;
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        text-decoration: none;
        margin-right: 10px;
        transition: background-color 0.3s;
    }

    .nav-links a:hover {
        background-color: #764ba2;
    }

    .no-data {
        text-align: center;
        padding: 40px;
        color: #999;
    }

    .value-currency::before {
        content: "$";
    }

    .value-percentage::after {
        content: "%";
    }
</style>

<div class="dashboard-container">
    <div class="dashboard-header">
        <div>
            <h1>Bienvenido, {{ company_name }}</h1>
            <p style="color: #666; margin: 5px 0 0 0;">Panel de control personalizado</p>
        </div>
        <a href="{{ url_for('logout') }}" class="logout-btn">Cerrar Sesi칩n</a>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div
        style="background-color: {% if category == 'success' %}#d4edda{% elif category == 'danger' %}#f8d7da{% else %}#d1ecf1{% endif %}; color: {% if category == 'success' %}#155724{% elif category == 'danger' %}#721c24{% else %}#0c5460{% endif %}; padding: 12px; border-radius: 5px; margin-bottom: 15px; border-left: 4px solid {% if category == 'success' %}#28a745{% elif category == 'danger' %}#dc3545{% else %}#17a2b8{% endif %};">
        {{ message }}
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <div class="stats-grid">
        <div class="stat-card accent1">
            <h3>Total Facturado</h3>
            <div class="value value-currency">{{ "%.2f"|format(total_facturado) }}</div>
        </div>
        <div class="stat-card accent2">
            <h3>Total Cobertura</h3>
            <div class="value value-currency">{{ "%.2f"|format(total_cobertura) }}</div>
        </div>
        <div class="stat-card accent3">
            <h3>Total Servicios</h3>
            <div class="value">{{ total_servicios }}</div>
        </div>
        <div class="stat-card accent4">
            <h3>Cobertura Promedio</h3>
            <div class="value value-percentage">{{ "%.1f"|format(promedio_cobertura) }}</div>
        </div>
    </div>

    <div class="nav-links">
        <a href="{{ url_for('companies_report') }}">游늵 Reporte por Empresa</a>
        <a href="{{ url_for('regions_report') }}">游늸 Reporte por Regi칩n</a>
    </div>

    {% if trabajos %}
    <div class="data-section">
        <h2>Tus Servicios y Trabajos (2023-2025)</h2>
        <table>
            <thead>
                <tr>
                    <th>A침o</th>
                    <th>Mes</th>
                    <th>Regi칩n</th>
                    <th>Cantidad Servicios</th>
                    <th>Valor por Servicio</th>
                    <th>% Cobertura</th>
                    <th>Total Facturado</th>
                </tr>
            </thead>
            <tbody>
                {% for trabajo in trabajos %}
                <tr>
                    <td>{{ trabajo.anio }}</td>
                    <td>{{ trabajo.mes }}</td>
                    <td>{{ trabajo.region }}</td>
                    <td>{{ trabajo.cantidad_servicios or 0 }}</td>
                    <td>${{ "%.2f"|format(trabajo.valor_por_servicio or 0) }}</td>
                    <td>{{ "%.1f"|format(trabajo.porcentaje_cobertura or 0) }}%</td>
                    <td>${{ "%.2f"|format((trabajo.cantidad_servicios or 0) * (trabajo.valor_por_servicio or 0)) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="data-section">
        <div class="no-data">
            <p>No hay datos disponibles para tu empresa en el per칤odo 2023-2025</p>
        </div>
    </div>
    {% endif %}
</div>

{% endblock %}